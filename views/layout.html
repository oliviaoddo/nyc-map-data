<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="/typed.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">  </script>
    <title>Rodents!</title>

        <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

    <!-- Bootstrap core CSS -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
<!--     <link href="/stylesheets/style.css" rel="stylesheet">
 -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div id="map"></div>

      <script>
        var map;
        var countMin = Number.MAX_VALUE, countMax = -Number.MAX_VALUE;
        function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: {lat: 40.7831, lng: -73.9712},
          zoomControl: true,
          scrollwheel: false
        });

        function styleFeature(feature) {
          var high = [5, 69, 54];  // color of smallest datum
          var low = [151, 83, 34];   // color of largest datum

          // delta represents where the value sits between the min and max
          var delta = (feature.getProperty('count') - countMin) /
              (countMax - countMin);

          var color = [];
          for (var i = 0; i < 3; i++) {
            // calculate an integer color based on the delta
            color[i] = (high[i] - low[i]) * delta + low[i];
          }
          return {
            strokeColor: '#fff',
            fillColor: 'hsl(' + color[0] + ',' + color[1] + '%,' + color[2] + '%)',
            fillOpacity: 0.75,
            strokeWeight: 2
          };
        }

        $(document).ready(function(){
          map.data.loadGeoJson('geoManhattan.json', { idPropertyName: 'name' }, function(Array){
              $.get("http://localhost:3000/map", function(data){
                data.shift();
                data.forEach(function(row){
                  const count = parseFloat(row[0]);
                  const name = row[1];
                  if (count < countMin) {
                    countMin = count;
                  }
                  if (count > countMax) {
                    countMax = count;
                  }
                  map.data.getFeatureById(name).setProperty('count', count);
                });
            });
              map.data.setStyle(styleFeature);
              // map.data.setStyle(function(feature) {
              //   var color = 'gray';
              //   return /** @type {google.maps.Data.StyleOptions} */({
              //     fillColor: feature.getProperty('color'),
              //     strokeColor: color,
              //     strokeWeight: 2
              //   });
              // });
          });
        });

        // // When the user hovers, tempt them to click by outlining the letters.
        // // Call revertStyle() to remove all overrides. This will use the style rules
        // // defined in the function passed to setStyle()
        // map.data.addListener('mouseover', function(event) {
        //   map.data.revertStyle();
        //   map.data.overrideStyle(event.feature, {strokeWeight: 8});
        // });

        // map.data.addListener('mouseout', function(event) {
        //   map.data.revertStyle();
        // });
        }
      </script>
    </div>

    <div id="footer">
      <div class="container">
        <p class="text-muted">Rodent Complaints</p>
      </div>
    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBukZ6vAJ-XjCyADpZ3Ebr_7O-ltyQsx-s&callback=initMap">
    </script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
  </body>
</html>
